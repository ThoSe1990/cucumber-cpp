trigger:
- '*'


jobs:
  - job: WindowsBuild
    pool:
      vmImage: 'windows-latest'
    steps:
    - script: | 
        choco install -y python3
        py.exe -m pip install cmake
        py.exe -m pip install conan
      displayName: Install CMake, Conan
    # - script: echo '##vso[task.prependpath]C:\hostedtoolcache\windows\Python\3.12.0\x64\Scripts'  # Replace with the actual path to Conan installation
    #   displayName: Extend PATH
    # C:\hostedtoolcache\windows\Python\3.12.0\x64\Scripts\conan.exe --version
   
    - script: |
        set PATH=%PATH%;C:\hostedtoolcache\windows\Python\3.12.0\x64\Scripts
        conan.exe --version  # Now you can use Conan
        conan.exe profile detect
        conan.exe profile show
        (Get-Content C:\Users\VssAdministrator\.conan2\profiles\default) | ForEach-Object { $_ -replace "compiler.cppstd=14", "compiler.cppstd=17" } | Set-Content C:\Users\VssAdministrator\.conan2\profiles\default
        (Get-Content C:\Users\VssAdministrator\.conan2\profiles\default) | ForEach-Object { $_ -replace "compiler.runtime=dynamic", "compiler.runtime=static" } | Set-Content C:\Users\VssAdministrator\.conan2\profiles\default
        conan.exe profile show
      displayName: 'Verify Conan installation'
    - script: cmake --version  # Now you can use Conan
      displayName: 'Verify CMake installation'
    - script: |
        cmake -S . -B ./build
        cmake --build ./build -j6
      displayName: 'CMake Build'
