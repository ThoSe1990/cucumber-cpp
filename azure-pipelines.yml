trigger:
- '*'


jobs:
  - job: WindowsBuild
    pool:
      vmImage: 'windows-latest'
    steps:
    - script: | 
        choco install -y python3
        py.exe -m pip install cmake
        py.exe -m pip install conan
      displayName: Install CMake, Conan
    # - script: echo '##vso[task.prependpath]C:\hostedtoolcache\windows\Python\3.12.0\x64\Scripts'  # Replace with the actual path to Conan installation
    #   displayName: Extend PATH
    # C:\hostedtoolcache\windows\Python\3.12.0\x64\Scripts\conan.exe --version
    - script: |
        echo "Adding Python Scripts directory to PATH"
        $pythonScriptsDir = (Get-Command py).Source
        $env:Path = [System.Environment]::GetEnvironmentVariable("Path", [System.EnvironmentVariableTarget]::Machine)
        $env:Path += ";$pythonScriptsDir"
        [System.Environment]::SetEnvironmentVariable("Path", $env:Path, [System.EnvironmentVariableTarget]::Machine)
        echo "Python Scripts directory added to PATH"
      displayName: 'Add Python Scripts directory to PATH'
    - script: conan.exe --version  # Now you can use Conan
      displayName: 'Verify Conan installation'
    - script: cmake --version  # Now you can use Conan
      displayName: 'Verify CMake installation'
    - script: |
        cmake -S . -B ./build
        cmake --build ./build -j6
      displayName: 'CMake Build'
